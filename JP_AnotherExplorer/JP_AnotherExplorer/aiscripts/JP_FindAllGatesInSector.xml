<?xml version="1.0" encoding="utf-8"?>

<aiscript name="JP_FindAllGatesInSector" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="aiscripts.xsd">

  <order id ="JP_FindAllGatesInSector" name="Get all gates from inside a sector" category="internal" infinite="false">
    <params>
      <param name="SHIP" type="object" text="ShipObject"/>
      <param name="SECTOR_TO_EXPLORE" type="object" text="SectorToExplore"/>
      <param name="DEBUG" type="bool" text="DebugText"/>
    </params>
  </order>

  <init>
  </init>

  <attention min="unknown">
    <actions>
      <create_list name="$Gates"/>
      <create_list name="$KnownGates"/>

      <find_gate name="$Gates" space="$SECTOR_TO_EXPLORE" multiple="true"/>
      <find_gate name="$KnownGates" space="$SECTOR_TO_EXPLORE" multiple="true" knownto="$SHIP.owner"/>
      <remove_from_list name="$Gates" list="$KnownGates"/>
      <remove_value name="$KnownGates"/>
      <shuffle_list list="$Gates"/>

      <do_if value="$DEBUG">
        <do_if value="$Gates.count gt 0">
          <debug_text text="'Found %1 unknown gates'.[$Gates.count]"/>
        </do_if>
        <do_else>
          <debug_text text="'No unknown gates found!'"/>
        </do_else>
      </do_if>

      <wait exact="1ms"/>
      <return>
        <retval name="GATES" value="$Gates" />
      </return>

      <remove_value name="$Gates"/>
    </actions>
  </attention>

</aiscript>