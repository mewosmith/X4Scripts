<?xml version="1.0" encoding="utf-8"?>

<aiscript name="JP_FindAllStationsInSector" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="aiscripts.xsd">

  <order id ="JP_FindAllStationsInSector" name="Get all stations from inside a sector" category="internal" infinite="false">
    <params>
      <param name="SHIP" type="object" text="ShipObject"/>
      <param name="SECTOR_TO_EXPLORE" type="object" text="SectorToExplore"/>
      <param name="DEBUG" type="bool" text="DebugText"/>
    </params>
  </order>

  <init>
  </init>

  <attention min="unknown">
    <actions>
      <create_list name="$Stations"/>
      <create_list name="$KnownStations"/>

      <find_station name="$Stations" space="$SECTOR_TO_EXPLORE" checkoperational="true" multiple="true"/>
      <find_station name="$KnownStations" space="$SECTOR_TO_EXPLORE" checkoperational="true" multiple="true" knownto="$SHIP.owner" />
      <remove_from_list name="$Stations" list="$KnownStations"/>
      <remove_value name="$KnownStations"/>
      <shuffle_list list="$Stations"/>

      <do_if value="$DEBUG">
        <do_if value="$Stations.count gt 0">
          <debug_text text="'Found %1 unknown stations'.[$Stations.count]"/>
        </do_if>
        <do_else>
          <debug_text text="'No unknown stations found!'"/>
        </do_else>
      </do_if>

      <wait exact="1ms"/>
      <return>
        <retval name="STATIONS" value="$Stations" />
      </return>

      <remove_value name="$Stations"/>
    </actions>
  </attention>

</aiscript>